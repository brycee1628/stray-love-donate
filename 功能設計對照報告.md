# 功能設計對照報告

根據功能設計文件，逐一對照檢查各功能模組的完成情況：

---

## 1.1 使用者身份驗證與授權（UC-01）

### 設計要求

-   ⚫ 實作安全的註冊登入機制
-   ⚫ 依據 RBAC 模型控管 Admin、Releaser、Adopter 三種角色的存取權限
-   ⚫ 包含帳號鎖定機制與密碼重設功能

### 實作狀態：✅ **100% 完成**

### 實作說明

#### 1. 安全的註冊登入機制

-   **實作位置**：[`src/views/Login.vue`](src/views/Login.vue), [`src/utils/auth.js`](src/utils/auth.js)
-   **功能說明**：
    -   使用 Firebase Authentication 進行安全認證
    -   支援 Email/Password 登入
    -   註冊後要求手動登入（不自動登入）
    -   密碼使用 Firebase 加密儲存

#### 2. RBAC 模型控管三種角色

-   **實作位置**：[`src/models/User.js`](src/models/User.js), [`src/router/guards.js`](src/router/guards.js)
-   **功能說明**：
    -   **User 基礎類別**：[`src/models/User.js`](src/models/User.js) 定義基礎使用者屬性
    -   **Releaser 類別**：[`src/models/Releaser.js`](src/models/Releaser.js) 繼承 User，用於送養人
    -   **Adopter 類別**：[`src/models/Adopter.js`](src/models/Adopter.js) 繼承 User，用於領養人
    -   **Admin 角色**：功能實作在 `src/utils/` 和 [`src/router/guards.js`](src/router/guards.js)
    -   **路由守衛**：[`src/router/guards.js`](src/router/guards.js) 的 `requireAdmin()` 函數確保管理員權限
    -   **角色導向**：登入後根據 `user.role` 導向對應頁面（Admin → `/admin`, 其他 → `/`）

#### 3. 帳號鎖定機制

-   **實作位置**：[`src/models/User.js`](src/models/User.js)
-   **功能說明**：
    -   `incrementFailedAttempts()` 方法：記錄登入失敗次數
    -   連續失敗 5 次後，自動鎖定帳號 30 分鐘
    -   `isLocked()` 方法：檢查帳號是否被鎖定
    -   `resetFailedAttempts()` 方法：登入成功時重置失敗次數

#### 4. 密碼重設功能

-   **實作位置**：[`src/views/Login.vue`](src/views/Login.vue), [`src/utils/auth.js`](src/utils/auth.js)
-   **功能說明**：
    -   `resetPassword()` 函數：使用 Firebase 的 `sendPasswordResetEmail()` 發送重設密碼郵件
    -   使用者輸入 Email 後，系統發送重設連結到註冊信箱

---

## 1.2 寵物資訊發布（UC-02）

### 設計要求

-   ⚫ 提供送養人標準化刊登介面
-   ⚫ 支援多媒體圖片上傳（限制 5 張）
-   ⚫ 健康履歷填寫
-   ⚫ 自動化的合規性預檢（過濾買賣關鍵字）

### 實作狀態：✅ **100% 完成**

### 實作說明

#### 1. 標準化刊登介面

-   **實作位置**：[`src/views/PetUpload.vue`](src/views/PetUpload.vue)
-   **功能說明**：
    -   完整的表單介面，包含基本資訊、詳細資訊、照片上傳等區塊
    -   必填欄位標示清楚（紅色星號）
    -   表單驗證與錯誤提示

#### 2. 多媒體圖片上傳（限制 5 張）

-   **實作位置**：[`src/views/PetUpload.vue`](src/views/PetUpload.vue) 第 92 行、第 176-189 行, [`src/utils/storage.js`](src/utils/storage.js)
-   **功能說明**：
    -   提示文字：「至少上傳一張照片，最多 5 張（每張不超過 2MB）」
    -   程式碼檢查：`if (photos.value.length + files.length > 5)` 限制最多 5 張
    -   每張照片限制 2MB（前端和後端雙重檢查）
    -   支援照片預覽和移除功能
    -   照片上傳到 Firebase Storage

#### 3. 健康履歷填寫

-   **實作位置**：[`src/views/PetUpload.vue`](src/views/PetUpload.vue) 第 67-83 行
-   **功能說明**：
    -   **已施打疫苗**：`isVaccinated` 勾選框
    -   **已結紮**：`isNeutered` 勾選框
    -   **健康狀況良好**：`isHealthy` 勾選框
    -   這些資訊會顯示在寵物卡片上（如「疫苗齊全」標籤）

#### 4. 自動化的合規性預檢（過濾買賣關鍵字）

-   **實作位置**：[`src/utils/validation.js`](src/utils/validation.js), [`src/views/PetUpload.vue`](src/views/PetUpload.vue) 第 247-256 行
-   **功能說明**：
    -   `validatePetData()` 函數檢查寵物名稱、描述、品種中是否包含禁止關鍵字
    -   禁止關鍵字列表：包含「買賣」、「出售」、「販售」等商業用語
    -   前端即時驗證，提交前攔截違規內容
    -   驗證失敗時顯示錯誤訊息，阻止提交

#### 5. 取消刊登機制

-   **實作位置**：[`src/views/PetUpload.vue`](src/views/PetUpload.vue) 第 130-132 行、第 280-288 行
-   **功能說明**：
    -   提供「取消/返回」按鈕，防止誤觸導致資料遺失
    -   點擊「取消/返回」時顯示確認對話框「確定要離開嗎?」
    -   確認後清除表單資料並導回首頁（不儲存）
    -   取消則繼續填寫，避免意外資料遺失

---

## 1.3 寵物資訊查詢與篩選（UC-03）

### 設計要求

-   ⚫ 具備高效能關鍵字搜尋引擎
-   ⚫ 提供品種、地區、年齡等多維度篩選與排序功能
-   ⚫ 提升媒合精準度

### 實作狀態：✅ **100% 完成**

### 實作說明

#### 1. 高效能關鍵字搜尋引擎

-   **實作位置**：[`src/utils/pets.js`](src/utils/pets.js) 的 `searchPets()` 函數
-   **功能說明**：
    -   使用 Firestore 的 `where` 和 `orderBy` 進行資料庫層級查詢
    -   支援關鍵字搜尋（寵物名稱、描述）
    -   降級方案：查詢失敗時使用客戶端過濾，確保功能可用性

#### 2. 多維度篩選功能

-   **實作位置**：[`src/views/Filter.vue`](src/views/Filter.vue) 第 11-61 行
-   **功能說明**：
    -   **種類篩選**：狗、貓、其他
    -   **年齡篩選**：幼年（1 歲以下）、成年（1-7 歲）、老年（7 歲以上）
    -   **性別篩選**：公、母
    -   **地區篩選**：台北市、新北市、桃園市、台中市、台南市、高雄市、其他
    -   **品種篩選**：透過關鍵字搜尋實現
    -   所有篩選條件可同時套用，互不干擾
    -   **套用篩選按鈕**：用戶選擇多個條件後，點擊「套用篩選」按鈕才執行篩選，避免即時更新造成的頻繁查詢

#### 3. 排序功能

-   **實作位置**：[`src/views/Filter.vue`](src/views/Filter.vue) 第 64-77 行
-   **功能說明**：
    -   **排序方式**：
        -   最新上架（`createTime`）
        -   地區（`location`）
        -   名稱（`name`）
    -   **排序方向**：
        -   降序（desc）
        -   升序（asc）
    -   排序變更時自動重新載入資料

#### 4. 提升媒合精準度

-   **實作位置**：[`src/views/Filter.vue`](src/views/Filter.vue), [`src/utils/pets.js`](src/utils/pets.js)
-   **功能說明**：
    -   多條件組合篩選，精準匹配使用者需求
    -   分頁顯示（每頁 6 筆），提升瀏覽體驗
    -   顯示符合條件的寵物數量
    -   支援清除條件和重新篩選

---

## 1.4 合作站點查詢（UC-04）

### 設計要求

-   ⚫ 提供中途之家與收容所的列表檢索功能
-   ⚫ 以「外部連結」方式整合 Google Maps 地標顯示
-   ⚫ 不串接付費 API 以控制成本

### 實作狀態：✅ **100% 完成**

### 實作說明

#### 1. 列表檢索功能

-   **實作位置**：[`src/views/Nearby.vue`](src/views/Nearby.vue), [`src/utils/shelters.js`](src/utils/shelters.js)
-   **功能說明**：
    -   **不輸入直接瀏覽**：`loadAllSites()` 函數載入所有站點
    -   **關鍵字搜尋**：`searchShelterSites()` 函數支援名稱、地址、地區搜尋
    -   **地區篩選**：下拉選單選擇地區進行篩選
    -   **關鍵字合法性檢查**：`validateKeyword()` 函數過濾無效輸入
    -   **站點詳細資訊頁**：點擊站點名稱或圖片可導向站點詳細資訊頁（[`src/views/SiteDetail.vue`](src/views/SiteDetail.vue)），顯示完整站點資訊

#### 2. 外部連結方式整合 Google Maps

-   **實作位置**：[`src/models/ShelterSite.js`](src/models/ShelterSite.js) 第 33-41 行
-   **功能說明**：
    -   `openMap()` 方法：讀取 `googleMapUrl` 屬性
    -   使用 `window.open()` 在新分頁開啟 Google Maps 連結
    -   不串接 Google Maps API，直接使用外部連結，無需付費
    -   連結為空時，按鈕自動停用（`hasMapUrl()` 方法檢查）

#### 3. 不串接付費 API

-   **實作位置**：[`src/models/ShelterSite.js`](src/models/ShelterSite.js)
-   **功能說明**：
    -   完全使用外部連結（`googleMapUrl`），不呼叫任何付費 API
    -   官方網站連結同樣使用外部連結（`openWebsite()` 方法）
    -   成本為零，符合設計要求

#### 4. 站點詳細資訊頁

-   **實作位置**：[`src/views/SiteDetail.vue`](src/views/SiteDetail.vue), [`src/router/index.js`](src/router/index.js)
-   **功能說明**：
    -   點擊站點列表中的站點名稱或圖片，導向站點詳細資訊頁（路由：`/nearby/:siteId`）
    -   顯示站點完整資訊：名稱、地址、電話、Email、說明
    -   提供「查看地圖」和「官方網站」按鈕
    -   包含返回按鈕，可返回站點列表

---

## 1.5 領養流程管理（UC-05）

### 設計要求

-   ⚫ 實現領養流程全數位化
-   ⚫ 涵蓋線上申請書填寫、個資同意簽署
-   ⚫ 申請單提交後由系統管理員進行統一審核
-   ⚫ 具備雙向狀態通知機制

### 實作狀態：✅ **100% 完成**

### 實作說明

#### 1. 領養流程全數位化

-   **實作位置**：[`src/views/Adoption.vue`](src/views/Adoption.vue), [`src/router/index.js`](src/router/index.js)
-   **功能說明**：
    -   完整的線上申請表單，無需紙本
    -   申請資料直接儲存到 Firestore
    -   申請狀態全程數位化追蹤（Pending → Approved/Rejected）
    -   **登入驗證**：未登入用戶訪問申請領養頁面時，自動導向登入頁（路由守衛：`requireAuth`）
    -   登入成功後自動返回原本想訪問的申請領養頁面

#### 2. 線上申請書填寫與個資同意簽署

-   **實作位置**：[`src/views/Adoption.vue`](src/views/Adoption.vue)
-   **功能說明**：
    -   **申請書欄位**：
        -   申請人姓名、電話、Email、地址
        -   居住環境、是否有庭院、飼養經驗
        -   照顧計畫、家庭成員
    -   **個資同意簽署**：`agreePrivacy` 勾選框，必須勾選才能提交
    -   表單驗證確保資料完整性

#### 3. 系統管理員統一審核

-   **實作位置**：[`src/views/Admin.vue`](src/views/Admin.vue), [`src/utils/adoption.js`](src/utils/adoption.js)
-   **功能說明**：
    -   申請單提交後，狀態設為 `Pending`
    -   管理員在後台看到待審核申請列表
    -   管理員可執行「通過」或「拒絕」操作
    -   拒絕時需輸入原因
    -   審核後自動更新申請狀態和寵物狀態

#### 4. 雙向狀態通知機制

-   **實作位置**：[`src/utils/adoption.js`](src/utils/adoption.js), [`src/App.vue`](src/App.vue), [`src/views/Notifications.vue`](src/views/Notifications.vue)
-   **功能說明**：
    -   **申請提交時**：自動建立通知給管理員（`adoption_pending` 類型）
    -   **審核通過時**：
        -   通知申請人（`adoption_approved` 類型）
        -   通知送養人（`adoption_approved_to_releaser` 類型）
    -   **審核拒絕時**：通知申請人（`adoption_rejected` 類型），包含拒絕原因
    -   **通知顯示**：
        -   導航欄通知鈴鐺顯示未讀數量
        -   點擊鈴鐺進入通知列表頁面
        -   實時更新通知狀態
    -   **通知管理**：支援標記已讀、標記全部已讀

---

## 1.6 內容審核與管理（UC-06）

### 設計要求

-   ⚫ 建置集中式後台管理系統
-   ⚫ 賦予管理員針對違規刊登、爭議帳號及領養申請進行審核、凍結或下架之權限
-   ⚫ 留存完整稽核軌跡（Audit Log）

### 實作狀態：✅ **100% 完成**

### 實作說明

#### 1. 集中式後台管理系統

-   **實作位置**：[`src/views/Admin.vue`](src/views/Admin.vue)
-   **功能說明**：
    -   統一的管理後台入口（`/admin`）
    -   功能導航卡片：
        -   刊登審核（`/admin/pet-review`）
        -   會員管理（`/admin/user-management`）
        -   稽核軌跡（`/admin/audit-log`）
    -   待審核領養申請列表（即時更新）

#### 2. 管理員權限與功能

-   **實作位置**：[`src/router/guards.js`](src/router/guards.js), [`src/views/PetReview.vue`](src/views/PetReview.vue), [`src/views/UserManagement.vue`](src/views/UserManagement.vue), [`src/views/Admin.vue`](src/views/Admin.vue)
-   **功能說明**：
    -   **權限檢查**：`requireAdmin()` 路由守衛確保只有管理員可存取
    -   **Session 有效性檢查**：防止未授權存取
    -   **違規刊登審核**：
        -   [`src/views/PetReview.vue`](src/views/PetReview.vue)：審核寵物上架申請
        -   可執行「通過」或「拒絕」操作
    -   **爭議帳號管理**：
        -   [`src/views/UserManagement.vue`](src/views/UserManagement.vue)：管理使用者帳號
        -   可執行「停權」或「解除停權」操作
    -   **領養申請審核**：
        -   [`src/views/Admin.vue`](src/views/Admin.vue)：審核領養申請
        -   可執行「通過」或「拒絕」操作，拒絕時需輸入原因

#### 3. 完整稽核軌跡（Audit Log）

-   **實作位置**：[`src/utils/audit.js`](src/utils/audit.js), [`src/views/AuditLog.vue`](src/views/AuditLog.vue)
-   **功能說明**：
    -   **記錄內容**：
        -   操作類型（PET_REVIEW_APPROVE, PET_REVIEW_REJECT, ADOPTION_APPROVE, ADOPTION_REJECT, USER_SUSPEND, USER_UNSUSPEND）
        -   管理員資訊（adminId, adminEmail, adminName）
        -   目標資訊（targetId, targetType）
        -   操作詳情（action, reason, previousStatus, newStatus）
        -   時間戳記（timestamp）
    -   **自動記錄**：
        -   寵物審核操作：[`src/utils/pets.js`](src/utils/pets.js) 的 `reviewPet()` 函數
        -   領養申請審核操作：[`src/utils/adoption.js`](src/utils/adoption.js) 的 `reviewAdoptionApplication()` 函數
        -   會員停權操作：[`src/utils/users.js`](src/utils/users.js) 的 `suspendUser()`, `unsuspendUser()` 函數
    -   **查看功能**：
        -   [`src/views/AuditLog.vue`](src/views/AuditLog.vue)：查看所有稽核記錄
        -   支援篩選（操作類型、目標類型）
        -   顯示完整操作資訊

---

## 總結

### 完成度統計

| 功能模組                       | 設計要求  | 實作狀態        | 完成度   |
| ------------------------------ | --------- | --------------- | -------- |
| **UC-01** 使用者身份驗證與授權 | 5 項      | ✅ 全部完成     | 100%     |
| **UC-02** 寵物資訊發布         | 5 項      | ✅ 全部完成     | 100%     |
| **UC-03** 寵物資訊查詢與篩選   | 3 項      | ✅ 全部完成     | 100%     |
| **UC-04** 合作站點查詢         | 4 項      | ✅ 全部完成     | 100%     |
| **UC-05** 領養流程管理         | 4 項      | ✅ 全部完成     | 100%     |
| **UC-06** 內容審核與管理       | 3 項      | ✅ 全部完成     | 100%     |
| **總計**                       | **24 項** | **✅ 全部完成** | **100%** |

### 結論

**所有功能設計要求均已完整實作，無遺漏項目。**

系統完全符合功能設計文件的規範，包含：

-   ✅ 安全的認證與授權機制
-   ✅ 完整的寵物資訊發布流程
-   ✅ 高效能的多維度查詢與篩選
-   ✅ 成本控制的外部連結整合
-   ✅ 全數位化的領養流程
-   ✅ 完整的後台管理與稽核機制

所有功能均已通過測試，可正常運作。
